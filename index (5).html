<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
        }
        
        .app {
            max-width: 800px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
        }
        
        .header {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .stats-row {
            display: flex;
            gap: 15px;
            justify-content: space-around;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 20px;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 11px;
            opacity: 0.9;
            margin-top: 3px;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #6366f1;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-outline {
            background: white;
            color: #6366f1;
            border: 2px solid #6366f1;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .form-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
            font-size: 14px;
        }
        
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
            font-family: inherit;
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .keyboard-toggle {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .keyboard-btn {
            flex: 1;
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.2s;
        }
        
        .keyboard-btn.active {
            border-color: #6366f1;
            background: #eef2ff;
            color: #6366f1;
        }
        
        .suggestions-container {
            position: relative;
        }
        
        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #6366f1;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-top: 5px;
        }
        
        .suggestion-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            font-size: 14px;
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .suggestion-item:hover {
            background: #f9fafb;
        }
        
        .suggestion-badge {
            display: inline-block;
            background: #dbeafe;
            color: #1e40af;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 8px;
            font-weight: 600;
        }
        
        .photo-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            cursor: pointer;
        }
        
        .photo-placeholder {
            width: 100%;
            height: 150px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .duplicate-warning {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .duplicate-title {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .duplicate-info {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .duplicate-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .inventory-list {
            margin-top: 30px;
        }
        
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .list-title {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .inventory-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            gap: 15px;
        }
        
        .item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
            cursor: pointer;
        }
        
        .item-image-placeholder {
            width: 80px;
            height: 80px;
            background: #f3f4f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 32px;
            flex-shrink: 0;
        }
        
        .item-details {
            flex: 1;
            min-width: 0;
        }
        
        .item-code {
            font-size: 13px;
            color: #6366f1;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            margin-bottom: 5px;
        }
        
        .item-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
            font-size: 15px;
        }
        
        .item-description {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .item-meta {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .item-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .item-extra {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 5px;
        }
        
        .item-actions {
            display: flex;
            gap: 8px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 8px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 600px) {
            .duplicate-actions {
                grid-template-columns: 1fr;
            }
            
            .item-meta {
                flex-direction: column;
                gap: 5px;
            }
            
            .inventory-item {
                flex-direction: column;
            }
            
            .item-image,
            .item-image-placeholder {
                width: 100%;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [view, setView] = useState('list');
            const [inventory, setInventory] = useState([]);
            const [editingItem, setEditingItem] = useState(null);
            
            // Form fields
            const [codiceArticolo, setCodiceArticolo] = useState('');
            const [barcode, setBarcode] = useState('');
            const [nomeProdotto, setNomeProdotto] = useState('');
            const [description, setDescription] = useState('');
            const [quantity, setQuantity] = useState('1');
            const [price, setPrice] = useState('');
            const [anno, setAnno] = useState('');
            const [fornitore, setFornitore] = useState('');
            const [productImage, setProductImage] = useState(null);
            
            const [codiceKeyboard, setCodiceKeyboard] = useState('text');
            const [barcodeKeyboard, setBarcodeKeyboard] = useState('numeric');
            const [nameSuggestions, setNameSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            
            const [message, setMessage] = useState(null);
            const [duplicateWarning, setDuplicateWarning] = useState(null);
            const [viewImageModal, setViewImageModal] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            
            const barcodeInputRef = useRef(null);
            const productInputRef = useRef(null);

            useEffect(() => {
                loadInventory();
            }, []);

            async function loadInventory() {
                try {
                    const result = await window.storage.get('inventory-pro-v2');
                    if (result && result.value) {
                        setInventory(JSON.parse(result.value));
                    }
                } catch (error) {
                    console.log('Nessun inventario salvato');
                }
            }

            async function saveInventory(data) {
                try {
                    await window.storage.set('inventory-pro-v2', JSON.stringify(data));
                } catch (error) {
                    console.error('Errore salvataggio:', error);
                }
            }

            async function handleBarcodePhoto(event) {
                const file = event.target.files[0];
                if (!file) return;

                showMessage('info', 'Analisi in corso...');
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const img = new Image();
                        img.onload = async () => {
                            const codeReader = new ZXing.BrowserMultiFormatReader();
                            try {
                                const result = await codeReader.decodeFromImageElement(img);
                                const code = result.getText();
                                setBarcode(code);
                                showMessage('success', `‚úì Bar Code rilevato: ${code}`);
                                navigator.vibrate?.(200);
                            } catch (err) {
                                showMessage('warning', '‚ö†Ô∏è Barcode non rilevato. Usa l\'input manuale.');
                            }
                        };
                        img.src = e.target.result;
                    } catch (error) {
                        showMessage('warning', 'Errore nella scansione.');
                    }
                };
                reader.readAsDataURL(file);
            }

            function handleProductPhoto(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    setProductImage(e.target.result);
                };
                reader.readAsDataURL(file);
            }

            function checkDuplicate(code) {
                const existing = inventory.find(item => item.codiceArticolo === code);
                if (existing && !editingItem) {
                    setDuplicateWarning(existing);
                } else {
                    setDuplicateWarning(null);
                }
            }

            function getNameSuggestions(text) {
                if (!text || text.length < 2) {
                    setNameSuggestions([]);
                    return;
                }

                const searchText = text.toLowerCase();
                const suggestions = new Set();

                if (codiceArticolo) {
                    const sameCodice = inventory.filter(item => 
                        item.codiceArticolo === codiceArticolo && 
                        item.nomeProdotto.toLowerCase().includes(searchText)
                    );
                    sameCodice.forEach(item => suggestions.add(item.nomeProdotto));
                }

                const allMatches = inventory
                    .filter(item => item.nomeProdotto.toLowerCase().includes(searchText))
                    .sort((a, b) => new Date(b.lastModified) - new Date(a.lastModified))
                    .slice(0, 20);
                
                allMatches.forEach(item => suggestions.add(item.nomeProdotto));

                const startsWith = inventory
                    .filter(item => item.nomeProdotto.toLowerCase().startsWith(searchText))
                    .sort((a, b) => new Date(b.lastModified) - new Date(a.lastModified))
                    .slice(0, 10);
                
                startsWith.forEach(item => suggestions.add(item.nomeProdotto));

                setNameSuggestions(Array.from(suggestions).slice(0, 20));
            }

            function handleNameChange(text) {
                setNomeProdotto(text);
                getNameSuggestions(text);
                setShowSuggestions(text.length >= 2);
            }

            function selectSuggestion(suggestion) {
                setNomeProdotto(suggestion);
                setShowSuggestions(false);
                setNameSuggestions([]);
            }

            function openExistingItem() {
                if (duplicateWarning) {
                    editItem(duplicateWarning);
                    setDuplicateWarning(null);
                }
            }

            function createNewAnyway() {
                setDuplicateWarning(null);
            }

            function saveItem() {
                if (!codiceArticolo || !barcode || !nomeProdotto || !quantity || !price) {
                    alert('Compila tutti i campi obbligatori: Codice Articolo, Bar Code, Nome Prodotto, Quantit√† e Prezzo!');
                    return;
                }

                const item = {
                    id: editingItem ? editingItem.id : Date.now().toString(),
                    codiceArticolo: codiceArticolo.trim(),
                    barcode: barcode.trim(),
                    nomeProdotto: nomeProdotto.trim(),
                    description: description.trim(),
                    quantity: parseInt(quantity),
                    price: parseFloat(price),
                    anno: anno.trim(),
                    fornitore: fornitore.trim(),
                    productImage: productImage,
                    timestamp: editingItem ? editingItem.timestamp : new Date().toISOString(),
                    lastModified: new Date().toISOString()
                };

                let updatedInventory;
                if (editingItem) {
                    updatedInventory = inventory.map(i => i.id === editingItem.id ? item : i);
                    showMessage('success', 'Articolo aggiornato!');
                } else {
                    updatedInventory = [item, ...inventory];
                    showMessage('success', 'Articolo aggiunto!');
                }

                setInventory(updatedInventory);
                saveInventory(updatedInventory);
                resetForm();
                setView('list');
            }

            function editItem(item) {
                setEditingItem(item);
                setCodiceArticolo(item.codiceArticolo);
                setBarcode(item.barcode);
                setNomeProdotto(item.nomeProdotto);
                setDescription(item.description || '');
                setQuantity(item.quantity.toString());
                setPrice(item.price.toString());
                setAnno(item.anno || '');
                setFornitore(item.fornitore || '');
                setProductImage(item.productImage);
                setView('edit');
            }

            function deleteItem(id) {
                if (confirm('Sei sicuro di voler eliminare questo articolo?')) {
                    const updatedInventory = inventory.filter(item => item.id !== id);
                    setInventory(updatedInventory);
                    saveInventory(updatedInventory);
                    showMessage('success', 'Articolo eliminato');
                }
            }

            function resetForm() {
                setCodiceArticolo('');
                setBarcode('');
                setNomeProdotto('');
                setDescription('');
                setQuantity('1');
                setPrice('');
                setAnno('');
                setFornitore('');
                setProductImage(null);
                setEditingItem(null);
                setDuplicateWarning(null);
                setCodiceKeyboard('text');
                setBarcodeKeyboard('numeric');
                setNameSuggestions([]);
                setShowSuggestions(false);
            }

            function exportToExcel() {
                const data = inventory.map(item => ({
                    'Codice Articolo': item.codiceArticolo,
                    'Bar Code': item.barcode,
                    'Nome Prodotto': item.nomeProdotto,
                    'Descrizione': item.description || '',
                    'Quantit√†': item.quantity,
                    'Prezzo Unitario': item.price,
                    'Valore Totale': item.quantity * item.price,
                    'Anno': item.anno || '',
                    'Fornitore': item.fornitore || '',
                    'Data Creazione': new Date(item.timestamp).toLocaleString('it-IT'),
                    'Ultima Modifica': new Date(item.lastModified).toLocaleString('it-IT')
                }));

                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Inventario');
                
                const maxWidth = data.reduce((w, r) => Math.max(w, r['Nome Prodotto'].length), 10);
                ws['!cols'] = [
                    { wch: 15 },
                    { wch: 15 },
                    { wch: maxWidth },
                    { wch: 30 },
                    { wch: 10 },
                    { wch: 12 },
                    { wch: 12 },
                    { wch: 10 },
                    { wch: 20 },
                    { wch: 18 },
                    { wch: 18 }
                ];

                XLSX.writeFile(wb, `inventario_${new Date().toISOString().split('T')[0]}.xlsx`);
                showMessage('success', 'Excel scaricato!');
            }

            function showMessage(type, text) {
                setMessage({ type, text });
                setTimeout(() => setMessage(null), 3000);
            }

            const totalItems = inventory.reduce((sum, item) => sum + item.quantity, 0);
            const totalValue = inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);

            const filteredInventory = inventory.filter(item => {
                const search = searchQuery.toLowerCase();
                return item.codiceArticolo.toLowerCase().includes(search) ||
                       item.barcode.toLowerCase().includes(search) ||
                       item.nomeProdotto.toLowerCase().includes(search) ||
                       (item.description && item.description.toLowerCase().includes(search)) ||
                       (item.fornitore && item.fornitore.toLowerCase().includes(search));
            });

            return (
                <div className="app">
                    <div className="header">
                        <h1>üì¶ Inventario Pro</h1>
                        <div className="stats-row">
                            <div className="stat">
                                <div className="stat-number">{inventory.length}</div>
                                <div className="stat-label">Articoli</div>
                            </div>
                            <div className="stat">
                                <div className="stat-number">{totalItems}</div>
                                <div className="stat-label">Unit√†</div>
                            </div>
                            <div className="stat">
                                <div className="stat-number">‚Ç¨{totalValue.toFixed(2)}</div>
                                <div className="stat-label">Valore</div>
                            </div>
                        </div>
                    </div>

                    <div className="main-content">
                        {message && (
                            <div className={`alert alert-${message.type}`}>
                                {message.type === 'success' ? '‚úì' : '‚ö†'} {message.text}
                            </div>
                        )}

                        {view === 'list' && (
                            <>
                                <div className="btn-group">
                                    <button className="btn btn-primary" onClick={() => setView('add')}>
                                        ‚ûï Nuovo Articolo
                                    </button>
                                    {inventory.length > 0 && (
                                        <button className="btn btn-success" onClick={exportToExcel}>
                                            üìä Esporta Excel
                                        </button>
                                    )}
                                </div>

                                {inventory.length > 0 && (
                                    <div className="search-box">
                                        <input
                                            type="text"
                                            className="search-input"
                                            placeholder="üîç Cerca articolo..."
                                            value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                        />
                                    </div>
                                )}

                                <div className="inventory-list">
                                    {filteredInventory.length === 0 && inventory.length === 0 && (
                                        <div className="empty-state">
                                            <div className="empty-icon">üì¶</div>
                                            <p>Nessun articolo nell'inventario</p>
                                            <p style={{ fontSize: '14px', marginTop: '10px' }}>
                                                Clicca "Nuovo Articolo" per iniziare
                                            </p>
                                        </div>
                                    )}

                                    {filteredInventory.length === 0 && inventory.length > 0 && (
                                        <div className="empty-state">
                                            <p>Nessun risultato per "{searchQuery}"</p>
                                        </div>
                                    )}

                                    {filteredInventory.map(item => (
                                        <div key={item.id} className="inventory-item">
                                            {item.productImage ? (
                                                <img
                                                    src={item.productImage}
                                                    alt={item.nomeProdotto}
                                                    className="item-image"
                                                    onClick={() => setViewImageModal(item.productImage)}
                                                />
                                            ) : (
                                                <div className="item-image-placeholder">üì¶</div>
                                            )}
                                            
                                            <div className="item-details">
                                                <div className="item-code">
                                                    {item.codiceArticolo} | {item.barcode}
                                                </div>
                                                <div className="item-name">{item.nomeProdotto}</div>
                                                {item.description && (
                                                    <div className="item-description">
                                                        {item.description}
                                                    </div>
                                                )}
                                                <div className="item-meta">
                                                    <div className="item-meta-item">
                                                        <span>üìä</span> {item.quantity} pz
                                                    </div>
                                                    <div className="item-meta-item">
                                                        <span>üí∞</span> ‚Ç¨{item.price.toFixed(2)}
                                                    </div>
                                                    <div className="item-meta-item">
                                                        <span>üíµ</span> ‚Ç¨{(item.quantity * item.price).toFixed(2)}
                                                    </div>
                                                </div>
                                                {(item.anno || item.fornitore) && (
                                                    <div className="item-extra">
                                                        {item.anno && `Anno: ${item.anno}`}
                                                        {item.anno && item.fornitore && ' | '}
                                                        {item.fornitore && `Fornitore: ${item.fornitore}`}
                                                    </div>
                                                )}
                                                <div className="item-actions">
                                                    <button 
                                                        className="btn btn-primary btn-small"
                                                        onClick={() => editItem(item)}
                                                    >
                                                        ‚úèÔ∏è Modifica
                                                    </button>
                                                    <button 
                                                        className="btn btn-danger btn-small"
                                                        onClick={() => deleteItem(item.id)}
                                                    >
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {(view === 'add' || view === 'edit') && (
                            <>
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => {
                                        resetForm();
                                        setView('list');
                                    }}
                                    style={{ marginBottom: '20px' }}
                                >
                                    ‚Üê Torna alla lista
                                </button>

                                {duplicateWarning && (
                                    <div className="duplicate-warning">
                                        <div className="duplicate-title">
                                            ‚ö†Ô∏è Codice Articolo gi√† esistente
                                        </div>
                                        <div className="duplicate-info">
                                            <strong>{duplicateWarning.nomeProdotto}</strong><br/>
                                            Bar Code: {duplicateWarning.barcode}<br/>
                                            Quantit√†: {duplicateWarning.quantity} | 
                                            Prezzo: ‚Ç¨{duplicateWarning.price.toFixed(2)}
                                        </div>
                                        <div className="duplicate-actions">
                                            <button 
                                                className="btn btn-warning btn-full"
                                                onClick={openExistingItem}
                                            >
                                                üìù Apri e Modifica
                                            </button>
                                            <button 
                                                className="btn btn-primary btn-full"
                                                onClick={createNewAnyway}
                                            >
                                                ‚ûï Crea Nuovo Comunque
                                            </button>
                                        </div>
                                    </div>
                                )}

                                <div className="form-section">
                                    <h2 style={{ marginBottom: '20px', color: '#1f2937' }}>
                                        {view === 'edit' ? 'Modifica Articolo' : 'Nuovo Articolo'}
                                    </h2>

                                    <div className="form-group">
                                        <label className="form-label">1. Codice Articolo *</label>
                                        <input
                                            type={codiceKeyboard === 'numeric' ? 'tel' : 'text'}
                                            className="form-input"
                                            value={codiceArticolo}
                                            onChange={(e) => {
                                                setCodiceArticolo(e.target.value);
                                                if (e.target.value.length >= 3) {
                                                    checkDuplicate(e.target.value);
                                                }
                                            }}
                                            placeholder="Inserisci codice articolo"
                                            autoFocus
                                            style={{ fontSize: '18px', fontFamily: 'monospace' }}
                                        />
                                        <div className="keyboard-toggle">
                                            <button
                                                type="button"
                                                className={`keyboard-btn ${codiceKeyboard === 'numeric' ? 'active' : ''}`}
                                                onClick={() => setCodiceKeyboard('numeric')}
                                            >
                                                üî¢ Numerica
                                            </button>
                                            <button
                                                type="button"
                                                className={`keyboard-btn ${codiceKeyboard === 'text' ? 'active' : ''}`}
                                                onClick={() => setCodiceKeyboard('text')}
                                            >
                                                üî§ Completa
                                            </button>
                                        </div>
                                    </div>

                                    {codiceArticolo.length >= 3 && (
                                        <>
                                            <div className="form-group">
                                                <label className="form-label">2. Bar Code *</label>
                                                <input
                                                    type={barcodeKeyboard === 'numeric' ? 'tel' : 'text'}
                                                    className="form-input"
                                                    value={barcode}
                                                    onChange={(e) => setBarcode(e.target.value)}
                                                    placeholder="Inserisci bar code"
                                                    style={{ fontSize: '18px', fontFamily: 'monospace' }}
                                                />
                                                <div className="keyboard-toggle">
                                                    <button
                                                        type="button"
                                                        className={`keyboard-btn ${barcodeKeyboard === 'numeric' ? 'active' : ''}`}
                                                        onClick={() => setBarcodeKeyboard('numeric')}
                                                    >
                                                        üî¢ Numerica
                                                    </button>
                                                    <button
                                                        type="button"
                                                        className={`keyboard-btn ${barcodeKeyboard === 'text' ? 'active' : ''}`}
                                                        onClick={() => setBarcodeKeyboard('text')}
                                                    >
                                                        üî§ Completa
                                                    </button>
                                                </div>
                                                <button 
                                                    className="btn btn-outline btn-full"
                                                    type="button"
                                                    onClick={() => barcodeInputRef.current.click()}
                                                    style={{ marginTop: '10px' }}
                                                >
                                                    üì∑ Scanner fotografico
                                                </button>
                                                <input 
                                                    type="file" 
                                                    accept="image/*" 
                                                    capture="environment"
                                                    ref={barcodeInputRef}
                                                    onChange={handleBarcodePhoto}
                                                />
                                            </div>

                                            <div className="form-group suggestions-container">
                                                <label className="form-label">3. Nome Prodotto *</label>
                                                <input
                                                    type="text"
                                                    className="form-input"
                                                    value={nomeProdotto}
                                                    onChange={(e) => handleNameChange(e.target.value)}
                                                    onFocus={() => nomeProdotto.length >= 2 && setShowSuggestions(true)}
                                                    onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
                                                    placeholder="Es: Vite M8x50"
                                                    style={{ fontSize: '16px' }}
                                                />
                                                {showSuggestions && nameSuggestions.length > 0 && (
                                                    <div className="suggestions-dropdown">
                                                        {nameSuggestions.map((suggestion, index) => {
                                                            const sameCodice = codiceArticolo && inventory.find(
                                                                item => item.codiceArticolo === codiceArticolo && item.nomeProdotto === suggestion
                                                            );
                                                            return (
                                                                <div
                                                                    key={index}
                                                                    className="suggestion-item"
                                                                    onClick={() => selectSuggestion(suggestion)}
                                                                >
                                                                    {suggestion}
                                                                    {sameCodice && (
                                                                        <span className="suggestion-badge">Stesso codice</span>
                                                                    )}
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                )}
                                                <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '5px' }}>
                                                    üí° Inizia a digitare per suggerimenti
                                                </div>
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">4. Descrizione (opzionale)</label>
                                                <textarea
                                                    className="form-textarea"
                                                    value={description}
                                                    onChange={(e) => setDescription(e.target.value)}
                                                    placeholder="Es: Acciaio inox A2, testa esagonale..."
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">5. Quantit√† *</label>
                                                <input
                                                    type="number"
                                                    inputMode="numeric"
                                                    className="form-input"
                                                    value={quantity}
                                                    onChange={(e) => setQuantity(e.target.value)}
                                                    min="0"
                                                    style={{ fontSize: '18px' }}
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">6. Prezzo Unitario (‚Ç¨) *</label>
                                                <input
                                                    type="number"
                                                    inputMode="decimal"
                                                    step="0.01"
                                                    className="form-input"
                                                    value={price}
                                                    onChange={(e) => setPrice(e.target.value)}
                                                    min="0"
                                                    placeholder="Es: 12.50"
                                                    style={{ fontSize: '18px' }}
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">7. Anno (opzionale)</label>
                                                <input
                                                    type="number"
                                                    inputMode="numeric"
                                                    className="form-input"
                                                    value={anno}
                                                    onChange={(e) => setAnno(e.target.value)}
                                                    placeholder="Es: 2024"
                                                    min="1900"
                                                    max="2100"
                                                    style={{ fontSize: '18px' }}
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">8. Fornitore (opzionale)</label>
                                                <input
                                                    type="text"
                                                    className="form-input"
                                                    value={fornitore}
                                                    onChange={(e) => setFornitore(e.target.value)}
                                                    placeholder="Es: ABC Forniture S.r.l."
                                                    style={{ fontSize: '16px' }}
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">9. Foto Prodotto (opzionale)</label>
                                                <button 
                                                    className="btn btn-secondary btn-full"
                                                    type="button"
                                                    onClick={() => productInputRef.current.click()}
                                                >
                                                    üì∑ {productImage ? 'Cambia Foto' : 'Aggiungi Foto'}
                                                </button>
                                                {productImage ? (
                                                    <img 
                                                        src={productImage} 
                                                        alt="Prodotto" 
                                                        className="photo-preview"
                                                        onClick={() => setViewImageModal(productImage)}
                                                    />
                                                ) : (
                                                    <div className="photo-placeholder">
                                                        Nessuna foto
                                                    </div>
                                                )}
                                            </div>

                                            <input 
                                                type="file" 
                                                accept="image/*" 
                                                capture="environment"
                                                ref={productInputRef}
                                                onChange={handleProductPhoto}
                                            />

                                            <button 
                                                className="btn btn-success btn-full"
                                                onClick={saveItem}
                                            >
                                                ‚úì {view === 'edit' ? 'Aggiorna' : 'Salva'} Articolo
                                            </button>

                                            {view === 'add' && (
                                                <button 
                                                    className="btn btn-secondary btn-full"
                                                    onClick={resetForm}
                                                >
                                                    ‚Ü∫ Reset Form
                                                </button>
                                            )}
                                        </>
                                    )}
                                </div>
                            </>
                        )}
                    </div>

                    {viewImageModal && (
                        <div className="modal" onClick={() => setViewImageModal(null)}>
                            <img src={viewImageModal} alt="Vista completa" className="modal-image" />
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
